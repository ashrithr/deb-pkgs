How to build deb packages
=========================

**Package Structure (Components):**

Sample `deb` package has the following structure:

```bash
ar tv package.deb
  * debian-binary
  * control.tar.gz
  * data.tar.gz
```

  - *debian-binary*: contents of this file is "2.0\n", this states the version of the deb file format. (For 2.0 all other lines are ignored)
  - *data.tar.gz*: contains all the files that will be installed with their destination paths (It's really just what you want to have installed)
  - *control.tar.gz*: a gzip'ed tar archive of some package control files.

**Creting debian packages:**

Creating debian packages should be handled by `dpkg-deb`

```bash
dpkg-deb --build <directory>
```
The directory must contain a `DEBIAN` subdirectory, which contains the control information files such as control file itself.

**Required Control Files:**

1. control - The control file describes the archive, whats in in which version and what is required to install it, see deb-control(5) for a full description.

	Example control file:

	```
	Package: linuxstatus
	Version: 1.1-1
	Section: base
	Priority: optional
	Architecture: all
	Depends: bash (>= 2.05a-11), textutils (>= 2.0-12), awk, procps (>= \
	1:2.0.7-8), sed (>= 3.02-8), grep (>= 2.4.2-3), coreutils (>= 5.0-5)
	Maintainer: Ankus <ankus@cloudwick.com>
	Description: Linux system information
	 This script provides a broad overview of different
	 system aspects.
	```

2. md5sums is optional, if present it should list the MD5 sums of the files in the archive

	  This file can be created with

	  ```
	  md5sum `find . -type f | awk '/.\// { print substr($0, 3) }'` >DEBIAN/md5sums
	  ```
	  from the packages top directory.

3. preinst, postinst, prerm and postrm are optional scripts that are run before or after the package has been installed or removed.

	Example postinst script:

	```
	#!/bin/sh -e
	update-inetd --comment-chars "#disabled#" --disable ftpproxy
	update-inetd --group OTHER --add "ftpproxy      stream  tcp     nowait  root    /usr/sbin/tcpd /usr/sbin/ftpproxy -e -l"
	# symlink management generated by debstd
	if [ "$1" = "configure" ]; then
	  if [ -d /usr/doc -a ! -e /usr/doc/ftpproxy -a -d /usr/share/doc/ftpproxy ]; then
	    ln -sf ../share/doc/ftpproxy /usr/doc/ftpproxy
	  fi
	fi
	```
	This example modifies the systems inetd configuration. Other possible actions are e.g. starting a standalone daemon after installation or shutting it down before removing it.

4. copyright contains information about the copyright and license of the upstream sources. `dh_make` can give you a template copyright file

5. changelog contains change information. `dh_make` can generate one

6. rules -  exact rules which dpkg-buildpackage(1) will use to actually create the package

More control files: http://www.debian.org/doc/manuals/maint-guide/dother.en.html


**Create Debian Packages with dpkg-deb**
 In the directory containing the data to install, add a directory called DEBIAN at the top level, containing the control files and maintainer scripts.

 ```bash
 ls mypackage-42
 DEBIAN etc usr var

 dpkg-deb -b mypackage-42
 ```

**Create Debian Packages hard way**

Build an archive of the files you want to package called data.tar.gz, a separate archive of the control files called control.tar.gz (no subdirectories), and a text file called debian-binary and containing the text 2.0.

```bash
cd mypackage-42
tar czf ../data.tar.gz [a-z]*
cd DEBIAN
tar czf ../../control.tar.gz *
cd ../..
echo 2.0 > debian-binary
ar r mypackage-42.deb debian-binary control.tar.gz data.tar.gz
```